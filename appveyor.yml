image: Visual Studio 2022

branches:
  # whitelist
  only:
    - master

skip_tags: false
skip_non_tags: false

before_build: 
  - cd src
  - dotnet restore
  - dotnet test

build: 
  project: src/Juka.sln

configuration:
- Release

artifacts:
- path: 'src\JukaC\bin\Release\net6.0'
  name: Juka_Exe_Windows_$(APPVEYOR_BUILD_VERSION)
  type: zip
- path: 'src\JukaAzureFunction\bin\Release\net6.0'
  name: Juka_Azure_Function_$(APPVEYOR_BUILD_VERSION)
  type: AzureCloudService
- path: 'src\JukaCompiler\bin\Release\net6.0'
  name: Juka_Compiler_dll_$(APPVEYOR_BUILD_VERSION)
  type: zip
- path: 'src\JukaNetwork\bin\Release\net6.0'
  name: Juka_Network_blockchain_$(APPVEYOR_BUILD_VERSION)
  type: zip


deploy:
    # Deploy to GitHub Releases
  - provider: GitHub
    artifact: /.*\.zip/
    auth_token:
      secure: XCqLJKrsMnRCCEEcsPL53Emba/2GrP172INtXx86eu5XBbed614ug/2dcx8MZwmr
    draft: false
    prerelease: false
    on:
      branch: master                # release from master branch only
      APPVEYOR_REPO_TAG: false       # deploy on tag push only
  - provider: GitHub
    artifact: /.*\.cspkg/
    auth_token:
      secure: XCqLJKrsMnRCCEEcsPL53Emba/2GrP172INtXx86eu5XBbed614ug/2dcx8MZwmr
    draft: false
    prerelease: false
    on:
      branch: master                # release from master branch only
      APPVEYOR_REPO_TAG: false       # deploy on tag push only